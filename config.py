# config.py
import logging
import sys
import os
import random 
from typing import Set, List

# --- –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ---
try:
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
    BASE_DIR = os.path.dirname(os.path.abspath(__file__))
    TOKEN_PATH = os.path.join(BASE_DIR, "token.txt")
    with open(TOKEN_PATH, "r") as file:
        TOKEN = file.read().strip()
    logging.info("–¢–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω –∏–∑ —Ñ–∞–π–ª–∞ token.txt")
except FileNotFoundError:
    logging.error("–§–∞–π–ª token.txt –Ω–µ –Ω–∞–π–¥–µ–Ω! ü•∫")
    sys.exit()
except Exception as e:
    exc_type, exc_obj, exc_tb = sys.exc_info()
    fname = exc_tb.tb_frame.f_code.co_filename
    lineno = exc_tb.tb_lineno
    logging.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞ ({fname}:{lineno}): {e} üò•")
    sys.exit()

# --- –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã ---
CHAT_ID: int = -1002017590469  # ID —á–∞—Ç–∞ –æ—Ç–±–æ—Ä–∞
BOT_USERNAME: str = "HataniAdminBot" 
ADMIN_IDS: Set[int] = {
    7485721661, 1052824235, 1867868165, 7385915582,
    650971663, 5192054637, 5723419877
}
USER_TO_DELETE: int = 5210630997 # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

# --- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ---
DATABASE_FILE: str = "bot_database.db"

# --- Redis (–¥–ª—è FSM Storage) ---
REDIS_HOST: str = 'localhost'
REDIS_PORT: int = 6379
REDIS_DB_FSM: int = 0 # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Redis –¥–ª—è FSM

# --- –ú–æ–¥–µ—Ä–∞—Ü–∏—è ---
MUTE_DURATION: int = 30 * 60  # 30 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
PROFANITY_WORDS: Set[str] = {
    "—Å—É–∫–∞", "–±–ª—è–¥—å", "–ø–∏–∑–¥–µ—Ü", "—Ö—É–π", "–µ–±–∞—Ç—å", "–≥–æ–Ω–¥–æ–Ω", "–ø–∏–¥–æ—Ä", "—Ö—É–µ—Å–æ—Å", "–º–∞—Ç—å", "–µ–±–ª–∞–Ω",
    "–º—É–¥–∞–∫", "—Ç–≤–∞—Ä—å", "—É–µ–±–æ–∫", "–∑–∞–ª—É–ø–∞", "–º–∞–Ω–¥–∞", "–∂–æ–ø–∞", "–¥–µ—Ä—å–º–æ", "–≥–æ–≤–Ω—é–∫", "–ø–∞–¥–ª–∞", "—à–ª—é—Ö–∞",
    "–ø–µ—Ç—É—Ö", "—á–µ—Ä—Ç", "–ª–æ—Ö", "—á–º–æ", "—É—Ä–æ–¥", "—Å—É—á–∫–∞", "–±–ª—è–¥–∏–Ω–∞", "–ø–∏–¥–∞—Ä–∞—Å", "—Ö—É–∏–ª–∞", "–º–∞—Ç–µ—Ä—å",
    "–µ–±–∞–Ω–∞—Ç", "–º—É–¥–∏–ª–∞", "—Å–∫–æ—Ç–∏–Ω–∞", "—É–µ–±–∏—â–µ", "–∑–∞–ª—É–ø–µ–Ω—å", "–º–∞–Ω–¥–æ–≤–æ—à–∫–∞", "–∂–æ–ø–∞—à–Ω–∏–∫", "–≥–æ–≤–Ω–æ", "–≥–æ–≤–Ω–æ–µ–¥",
    "–ø–∞—Å–∫—É–¥–∞", "–±–ª—è–¥—é–≥–∞", "–∫—É—Ä–∏—Ü–∞", "–¥—å—è–≤–æ–ª", "–ª–æ—à–∞—Ä–∞", "—á–µ—Ä—Ç–∏–ª–∞", "–≤—ã—Ä–æ–¥–æ–∫", "—Å—É—á–∞—Ä–∞", "–±–ª—è–¥—Å–∫–∞—è",
    "–ø–∏–¥—Ä–∏–ª–∞", "—Ö—É–π–Ω—è", "–º–∞–º–∞—à–∞", "–µ–±–∞–Ω—É—Ç—ã–π", "–º—É–¥–æ–∑–≤–æ–Ω", "–≥–∞–¥–∏–Ω–∞", "—É–µ–±–∞–Ω", "–∑–∞–ª—É–ø–∏–Ω–∞", "–º–∞–Ω–¥–∏—â–µ",
    "–∂–æ–ø–∏—â–∞", "–≥–æ–≤–Ω–∏—â–µ", "–≥–æ–≤–Ω—é—à–∫–∞", "—Å—Ç–µ—Ä–≤–∞", "–±–ª—è–¥—é—à–∫–∞", "–∫–æ–∑–µ–ª", "–±–µ—Å", "–±–æ—Ç–∞–Ω–∏–∫", "—á—É—Ä–∫–∞",
    "–¥–µ–±–∏–ª", "—Å—É—á—å–µ", "–±–ª—è–¥—Å—Ç–≤–æ", "–ø–∏–¥–æ—Ä—Å–∫–∏–π", "—Ö—É–µ–≤—ã–π", "–º–∞–º–∞", "–µ–±–∞–Ω—å–∫–æ", "–º—É–¥–æ—Ä–µ–∑", "–≥–Ω–∏–¥–∞",
    "—É–µ–±—Å–∫–∏–π", "–∑–∞–ª—É–ø–Ω—ã–π", "–º–∞–Ω–¥–æ–≤—ã–π", "–∂–æ–ø–Ω—ã–π", "–≥–æ–≤–Ω—è–Ω—ã–π", "–≥–æ–≤–Ω—é—á–∏–π", "–º–µ—Ä–∑–∞–≤–µ—Ü", "–±–ª—è–¥—Å–∫–∏–π",
    "–æ—Å–µ–ª", "—Å–∞—Ç–∞–Ω–∞", "–∑—É–±—Ä–∏–ª–∞", "—Ö–∞—á", "–∫—Ä–µ—Ç–∏–Ω", "—Å—É—á–µ–Ω—ã—à", "–±–ª—è–¥—é–∂–Ω–∏–∫", "–ø–∏–¥–æ—Ä–º–æ—Ç", "—Ö—É–µ–ø–ª–µ—Å",
    "—Ä–æ–¥–∏—Ç–µ–ª–∏", "–µ–±–∞—Ç–æ—Ä–∏—è", "–º—É–¥–æ–∑–≤–æ–Ω—Å—Ç–≤–æ", "–ø–∞–¥–∞–ª—å", "—É–µ–±–∏—â–Ω—ã–π", "–∑–∞–ª—É–ø–æ–≥–æ–ª–æ–≤—ã–π", "–º–∞–Ω–¥–æ—Ç—Ä—è—Å",
    "–∂–æ–ø–æ–ª–∏–∑", "–≥–æ–≤–Ω–æ–º–µ—Ç", "–≥–æ–≤–Ω—è—Ç–∏–Ω–∞", "–ø–æ–¥–ª–µ—Ü", "–±–ª—è–¥–æ—Ç–∞", "–±–∞—Ä–∞–Ω", "—à–∞–π—Ç–∞–Ω", "–æ—á–∫–∞—Ä–∏–∫",
    "—á—É—Ä–±–∞–Ω", "–∏–¥–∏–æ—Ç", "—É–±–ª—é–¥–æ–∫", "–∑–∞—Å—Ä–∞–Ω–µ—Ü", "–¥—É—Ä–∞–∫", "–∫—Ä–µ—Ç–∏–Ω", "–ø—Ä–∏–¥—É—Ä–æ–∫", "—Ç—É–ø–∏—Ü–∞", "–æ—Å—Ç–æ–ª–æ–ø",
    "–±–∞–ª–±–µ—Å", "–±–æ–ª–≤–∞–Ω", "–ª–æ–ø—É—Ö", "–º–µ–º–±—Ä–∞–Ω–∞", "–¥—ã—Ä–∫–∞", "–≤–∞–≥–∏–Ω–∞", "–ø–µ–Ω–∏—Å", "—è–π—Ü–∞", "–º–æ—à–æ–Ω–∫–∞",
    "—Å—Å–∞–Ω—å–µ", "–ø–µ—Ä–¥–µ–∂", "–±–ª–µ–≤–æ—Ç–∏–Ω–∞", "–∑–∞–¥—Ä–æ—Ç", "–≥–µ–π", "–ª–µ—Å–±–∏—è–Ω–∫–∞", "—Ç—Ä–∞–Ω—Å–≤–µ—Å—Ç–∏—Ç", "–≥–µ—Ä–º–∞—Ñ—Ä–æ–¥–∏—Ç",
    "–∏–º–ø–æ—Ç–µ–Ω—Ç", "—Ñ—Ä–∏–≥–∏–¥–Ω–∞—è", "–æ–Ω–∞–Ω–∏—Å—Ç", "–º–∞—Å—Ç—É—Ä–±–∞—Ç–æ—Ä", "–∏–∑–≤—Ä–∞—â–µ–Ω–µ—Ü", "—Ñ–µ—Ç–∏—à–∏—Å—Ç", "–∑–æ–æ—Ñ–∏–ª",
    "–ø–µ–¥–æ—Ñ–∏–ª", "–Ω–µ–∫—Ä–æ—Ñ–∏–ª", "–∫–æ–ø—Ä–æ—Ñ–∏–ª", "—É—Ä–æ—Ñ–∏–ª", "—Å–∫–æ—Ç–∏–Ω–∞", "—Ç–≤–∞—Ä—å", "–º—Ä–∞–∑—å", "–≥–∞–¥", "–∑–≤–µ—Ä—å",
    "–ø–∞—Ä–∞–∑–∏—Ç", "–ø–∏—è–≤–∫–∞", "–≤—à–∏–≤—ã–π", "–≤—à–∏–≤–∞—è", "–±–ª–æ—Ö–∞—Å—Ç—ã–π", "–≥–ª–∏—Å—Ç", "—á–µ—Ä–≤—è–∫", "—Ç–∞—Ä–∞–∫–∞–Ω", "–∫—Ä—ã—Å–∞",
    "—Å–≤–æ–ª–æ—á—å", "—Å—Ç–µ—Ä–≤–µ—Ü", "—Å—Ç–µ—Ä–≤–æ–∑–∞", "—Å—Ç–µ—Ä–≤–æ–∑–Ω—ã–π", "—Å—É—á–∏–π", "–±–ª—è–¥—Å–∫–∏–π", "–ø–∏–¥–æ—Ä—Å–∫–∏–π", "—Ö—É–µ–≤—ã–π",
    "–µ–±–∞–Ω—ã–π", "–ø–∏–∑–¥–µ—Ü–∫–∏", "—Ö—É–µ–≤–æ", "–±–ª—è–¥—Å–∫–∏", "–µ–±–∞–Ω–æ", "–ø–∏–∑–¥–µ—Ü",
}
if len(PROFANITY_WORDS) < 100:
    logging.warning(f"–í–Ω–∏–º–∞–Ω–∏–µ: –í —Å–ø–∏—Å–∫–µ –Ω–µ–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–π –ª–µ–∫—Å–∏–∫–∏ —Å–µ–π—á–∞—Å {len(PROFANITY_WORDS)} —Å–ª–æ–≤. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ.")
else:
    logging.info(f"–í —Å–ø–∏—Å–∫–µ –Ω–µ–Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–π –ª–µ–∫—Å–∏–∫–∏ {len(PROFANITY_WORDS)} —Å–ª–æ–≤.")

# --- –û—Ç–±–æ—Ä ---
SELECTION_INACTIVE_KICK_DELAY: int = 10 * 60 
TIKTOK_SUBSCRIBER_THRESHOLD: int = 1000
REJECTED_PROGRAMS: Set[str] = {"CapCut", "Kine Master", "Power Direct"}
MAX_EDIT_FILE_SIZE_MB: int = 15
MAX_EDIT_FILE_SIZE_BYTES: int = MAX_EDIT_FILE_SIZE_MB * 1024 * 1024
EDIT_PROGRAM_CHOICES: dict = {
    "CapCut": "CapCut", "Kine Master": "Kine Master", "Power Direct": "Power Direct",
    "After Motion Z": "After Motion Z", "Alight Motion": "Alight Motion", "After Effects": "After Effects",
    "Node": "Node", "Sony Vegas": "Sony Vegas", "other": "–î—Ä—É–≥–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞"
}
SELECTION_STEPS: List[str] = ["TikTok", "–ü–æ–¥–ø–∏—Å—á–∏–∫–∏", "–ü—Ä–æ–≥—Ä–∞–º–º–∞", "–≠–¥–∏—Ç"]
SELECTION_PROGRESS_FORMAT: str = "üìä –ü—Ä–æ–≥—Ä–µ—Å—Å: {current}/{total} | {steps_str}" 

def format_progress(current_step_index: int) -> str:
    total_steps = len(SELECTION_STEPS)
    steps_list = []
    for i, name in enumerate(SELECTION_STEPS):
        if i < current_step_index:
            steps_list.append(f"‚úÖ {name}")
        elif i == current_step_index:
            steps_list.append(f"‚û°Ô∏è {name}") 
        else:
            steps_list.append(f"‚è≥ {name}") 
    steps_str = " | ".join(steps_list)
    return SELECTION_PROGRESS_FORMAT.format(current=current_step_index + 1, total=total_steps, steps_str=steps_str)

REJECTION_REASONS: dict = {
    "tech": "–°–ª–∞–±–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ / —ç—Ñ—Ñ–µ–∫—Ç—ã", "quality": "–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ", "idea": "–°–ª–∞–±–∞—è –∏–¥–µ—è / –Ω–µ–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ",
    "music": "–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º—É–∑—ã–∫–µ / —Ä–∏—Ç–º—É", "other": "–î—Ä—É–≥–æ–µ (–æ–±—â–∞—è –æ—Ü–µ–Ω–∫–∞)"
}

# --- URL ---
CREATOR_PROFILE_URL: str = "https://t.me/ILYAA2K23"
CREATOR_TIKTOK_URL: str = "https://www.tiktok.com/@tpebop.fx?_t=ZT-8ulfiFwpFHi&_r=1"
AGREEMENT_URL: str = "https://teletype.in/@rewix_x/bZRg7isIVXi"
RULES_URL: str = "https://teletype.in/@rewix_x/VDwYWdPiOrc"
SELECTION_CHAT_URL: str = "https://t.me/hatani_selection"

# --- –¢–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π ---
MSG_PRIVATE_CHAT_REDIRECT: str = f"–î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –æ—Ç–±–æ—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –±–µ—Å–µ–¥–µ: {SELECTION_CHAT_URL}"
MSG_ALREADY_STARTED_SELECTION: str = "‚ö†Ô∏è –í—ã —É–∂–µ –Ω–∞—á–∞–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–±–æ—Ä–∞."
MSG_ALREADY_COMPLETED_SELECTION: str = "‚ö†Ô∏è –í—ã —É–∂–µ –ø—Ä–æ—à–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–±–æ—Ä–∞."
MSG_ADMIN_ONLY_COMMAND: str = "‚ö†Ô∏è –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º."
MSG_ADMIN_ONLY_BUTTON: str = "‚ö†Ô∏è –≠—Ç–∞ –∫–Ω–æ–ø–∫–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏."
MSG_WRONG_CHAT: str = "‚ö†Ô∏è –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –±–µ—Å–µ–¥–µ –æ—Ç–±–æ—Ä–∞."
POSITIVE_RESPONSES: List[str] = ["–û—Ç–ª–∏—á–Ω–æ!", "–°—É–ø–µ—Ä!", "–ü—Ä–∏–Ω—è—Ç–æ!", "–•–æ—Ä–æ—à–æ!", "–ü–æ–Ω—è–ª!", "–ó–∞–ø–∏—Å–∞–ª!"]
PROMPT_PHRASES: List[str] = ["–¢–µ–ø–µ—Ä—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞,", "–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:", "–î–∞–ª–µ–µ:", "–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ:"]

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è ---
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - [%(filename)s:%(lineno)d] - %(message)s')

# <<< –î–û–ë–ê–í–õ–ï–ù –¢–û–ö–ï–ù –î–õ–Ø –û–ë–•–û–î–ê –ó–ê–©–ò–¢–´ >>>
# –¢–æ–∫–µ–Ω –æ—Ç —Å–µ—Ä–≤–∏—Å–∞ Monster API (DataDome) –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∫–∞–ø—á–∏
ANTI_BOT_TOKEN: str = "v6WanzZx7tQmhaPMnkSlb_CDSKAP5xesvPUoOiB4NSspNXhTzmnP12HatUEd-H7lbmlZW8b-pS9-X4uqS3_V6EXnhsmKxI5bJMvA2oxOx9YO5Q0d2SohORwiVrW5ym4TsrocBZOvLgPHigWd-ZlS"